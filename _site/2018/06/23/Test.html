<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Test post &middot; Inception
    
  </title>

  
    






  

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/blackdoc.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=EB+Garamond">
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-07">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Inception
        </a>
      </h1>
      <p class="lead">Python. Machine Learning. Deep Learning.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about.html">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive.html">Archive</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/resource.html">Resource</a>
          
        
      
        
      

      <img src="/public/images/Neuron-spark.jpg" alt="test image">
      <!-- <img src="/public/images/space1.png" alt="test image"> -->

      <hr>
      <a class="sidebar-nav-item" href="https://twitter.com/pharrellyhy">Twitter</a>
      <a class="sidebar-nav-item" href="https://github.com/pharrellyhy">GitHub</a>
    </nav>


    <p class="lead">&copy; Pharrell Yang
      <br /> 2017 - 2018
      <br /> All rights reserved.
    </p>

  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Test post</h1>
  <span class="post-date">Jun 23 2018</span>
  <span>
    
      
      <a href="/tag/Python"><code class="highligher-rouge"><nobr>Python</nobr></code>&nbsp;</a>
    
      
      <a href="/tag/ML"><code class="highligher-rouge"><nobr>ML</nobr></code>&nbsp;</a>
    
      
      <a href="/tag/DL"><code class="highligher-rouge"><nobr>DL</nobr></code>&nbsp;</a>
    
  </span>

  <p>Test coding style</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">argparse</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>


<span class="k">def</span> <span class="nf">load_graph</span><span class="p">(</span><span class="n">model_file</span><span class="p">):</span>
  <span class="n">graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
  <span class="n">graph_def</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">GraphDef</span><span class="p">()</span>

  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_file</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">graph_def</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
  <span class="k">with</span> <span class="n">graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">import_graph_def</span><span class="p">(</span><span class="n">graph_def</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">graph</span>


<span class="k">def</span> <span class="nf">read_tensor_from_image_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span>
                                <span class="n">input_height</span><span class="o">=</span><span class="mi">299</span><span class="p">,</span>
                                <span class="n">input_width</span><span class="o">=</span><span class="mi">299</span><span class="p">,</span>
                                <span class="n">input_mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">input_std</span><span class="o">=</span><span class="mi">255</span><span class="p">):</span>
  <span class="n">input_name</span> <span class="o">=</span> <span class="s">"file_reader"</span>
  <span class="n">output_name</span> <span class="o">=</span> <span class="s">"normalized"</span>
  <span class="n">file_reader</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">input_name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".png"</span><span class="p">):</span>
    <span class="n">image_reader</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">decode_png</span><span class="p">(</span>
        <span class="n">file_reader</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"png_reader"</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".gif"</span><span class="p">):</span>
    <span class="n">image_reader</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">decode_gif</span><span class="p">(</span><span class="n">file_reader</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"gif_reader"</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".bmp"</span><span class="p">):</span>
    <span class="n">image_reader</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">decode_bmp</span><span class="p">(</span><span class="n">file_reader</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"bmp_reader"</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">image_reader</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">decode_jpeg</span><span class="p">(</span>
        <span class="n">file_reader</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"jpeg_reader"</span><span class="p">)</span>
  <span class="n">float_caster</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">image_reader</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">dims_expander</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">float_caster</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="n">resized</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize_bilinear</span><span class="p">(</span><span class="n">dims_expander</span><span class="p">,</span> <span class="p">[</span><span class="n">input_height</span><span class="p">,</span> <span class="n">input_width</span><span class="p">])</span>
  <span class="n">normalized</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">resized</span><span class="p">,</span> <span class="p">[</span><span class="n">input_mean</span><span class="p">]),</span> <span class="p">[</span><span class="n">input_std</span><span class="p">])</span>
  <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">load_labels</span><span class="p">(</span><span class="n">label_file</span><span class="p">):</span>
  <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">proto_as_ascii_lines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gfile</span><span class="o">.</span><span class="n">GFile</span><span class="p">(</span><span class="n">label_file</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">proto_as_ascii_lines</span><span class="p">:</span>
    <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
  <span class="k">return</span> <span class="n">label</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
  <span class="n">file_name</span> <span class="o">=</span> <span class="s">"tensorflow/examples/label_image/data/grace_hopper.jpg"</span>
  <span class="n">model_file</span> <span class="o">=</span> \
    <span class="s">"tensorflow/examples/label_image/data/inception_v3_2016_08_28_frozen.pb"</span>
  <span class="n">label_file</span> <span class="o">=</span> <span class="s">"tensorflow/examples/label_image/data/imagenet_slim_labels.txt"</span>
  <span class="n">input_height</span> <span class="o">=</span> <span class="mi">299</span>
  <span class="n">input_width</span> <span class="o">=</span> <span class="mi">299</span>
  <span class="n">input_mean</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">input_std</span> <span class="o">=</span> <span class="mi">255</span>
  <span class="n">input_layer</span> <span class="o">=</span> <span class="s">"input"</span>
  <span class="n">output_layer</span> <span class="o">=</span> <span class="s">"InceptionV3/Predictions/Reshape_1"</span>

  <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--image"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"image to be processed"</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--graph"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"graph/model to be executed"</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--labels"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"name of file containing labels"</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--input_height"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"input height"</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--input_width"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"input width"</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--input_mean"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"input mean"</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--input_std"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"input std"</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--input_layer"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"name of input layer"</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--output_layer"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"name of output layer"</span><span class="p">)</span>
  <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
    <span class="n">model_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">graph</span>
  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">image</span><span class="p">:</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">image</span>
  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
    <span class="n">label_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">labels</span>
  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">input_height</span><span class="p">:</span>
    <span class="n">input_height</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_height</span>
  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">input_width</span><span class="p">:</span>
    <span class="n">input_width</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_width</span>
  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">input_mean</span><span class="p">:</span>
    <span class="n">input_mean</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_mean</span>
  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">input_std</span><span class="p">:</span>
    <span class="n">input_std</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_std</span>
  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">input_layer</span><span class="p">:</span>
    <span class="n">input_layer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_layer</span>
  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">output_layer</span><span class="p">:</span>
    <span class="n">output_layer</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">output_layer</span>

  <span class="n">graph</span> <span class="o">=</span> <span class="n">load_graph</span><span class="p">(</span><span class="n">model_file</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">read_tensor_from_image_file</span><span class="p">(</span>
      <span class="n">file_name</span><span class="p">,</span>
      <span class="n">input_height</span><span class="o">=</span><span class="n">input_height</span><span class="p">,</span>
      <span class="n">input_width</span><span class="o">=</span><span class="n">input_width</span><span class="p">,</span>
      <span class="n">input_mean</span><span class="o">=</span><span class="n">input_mean</span><span class="p">,</span>
      <span class="n">input_std</span><span class="o">=</span><span class="n">input_std</span><span class="p">)</span>

  <span class="n">input_name</span> <span class="o">=</span> <span class="s">"import/"</span> <span class="o">+</span> <span class="n">input_layer</span>
  <span class="n">output_name</span> <span class="o">=</span> <span class="s">"import/"</span> <span class="o">+</span> <span class="n">output_layer</span>
  <span class="n">input_operation</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_operation_by_name</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>
  <span class="n">output_operation</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_operation_by_name</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>

  <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">output_operation</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">{</span>
        <span class="n">input_operation</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">t</span>
    <span class="p">})</span>
  <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

  <span class="n">top_k</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="o">-</span><span class="mi">5</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="n">load_labels</span><span class="p">(</span><span class="n">label_file</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">top_k</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div>

</div>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2018/03/14/Legend-Never-Die.html">
            Legend Never Dies
            <small>Mar 14 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2017/01/18/Pythonic-Thinking.html">
            Pythonic Thinking
            <small>Jan 18 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
